## Basic Paxos

用于对某**一个**值的提案达成共识。例如对于变量a在分布式环境下在一次提案中要被设置什么值。

有三种角色：

* Proposer (提案节点)：提出对某个值进行设置操作的节点。设置的行为被称为Proposal（提案）
* Acceptor（决策节点）：应答提案的节点。决定该提案是否可被投票，是否可被接受。如果一个提案操作最终被接受，则成为批准（Accept）。意味着这个值不会再被修改也不会丢失
* Learner（记录节点）：仅仅用于学习已经达成共识是的提案

实际部署上，这三种角色往往都是在同一个节点上，也就是说一个节点既是Proposer也是Acceptor、Learner

 Paxos算法主要有两阶段，prepare和accept，流程如下（强调，以下流程只对于**一次**对某**一个**值的设置达成共识）：

**Prepare请求->Promise应答->Accept请求->Accept应答**

1. 某个提案节点想要发起提案，则它向所有决策节点**广播**一个**Prepare请求** 

   > prepare请求包含自身节点ID和一个全局唯一单调递增的**提案ID**，这里称它为n

2. 决策节点基于自身的承诺，给与一个**Promise应答**

   > 决策节点会承诺：
   >
   > 1、不再接受提案ID小于等于n的**Prepare请求** 
   >
   > 2、承诺不会再接受小于n的**Accept请求**（下文提到）
   >
   > 
   >
   > case 1 ：如果这个决策节点对于这个值的设置已经有过**Accept应答**，则返回**Accept应答**中最大的提案ID和对应的值
   >
   > case 2：如果之前没有收到过对这个值进行设置的提案，则返回空值
   >
   > case 3 ：即不符合上述承诺的情况下（已经收到提案ID更大的**Prepare请求**或**Accept请求**），不予响应

3. 提案节点收到**多数派** **Promise应答**后（即上述case1、case2的情况），开始发出第二阶段**Accept请求**

   > case 1 ：如果这些**Promise应答**中**至少有一个**返回值了，代表有其他提案节点已经设置过值且被那个决策节点**Accept应答**了。它将找出这些**有值Accept应答**中提案ID最大的那个值然后再次**广播**给**所有决策节点**一个**Accept请求**（包含**自身**提案ID、找到的最大值与节点ID）
   >
   > case 2 ：如果这些**Promise应答**都为空值，代表之前没有节点对这个值有过提案。它可以自己设置值，
   >
   > 它将再次**广播**给**所有决策节点**一个**Accept请求**（包**自身**提案ID、选定的值与节点ID）

4. 决策节点基于上述的两个承诺，给与**Accept响应**

   > case 1 : 不违背承诺（意味着没有提案ID更大的**Prepare请求**和**Accept请求**来过），则批准这个设置并持久化
   >
   > case 2: 违背承诺，不予响应

5.  提案节点如果收到了**多数派Accept响应**则共识形成，流程结束

## Multi Paxos





